Motion planning: OpenRave
----------
Allgemeines zu ROS:
https://www.generationrobots.com/blog/de/ros-robot-operating-system/

ROS Version:
melodic

(nur Kern) ROS starten (neues Konsolenfenster):
roscore

Laufende Nodes anschauen:
rosnode list

Node Verbindungen anschauen:
rosrun rqt_graph rqt_graph

neues Kommando installieren:
sudo apt-get install ros-<distro="melodic">-<Kommando>
//sudo apt-get install python-catkin-tools ->gibt catkin clean
//sudo apt-get install python-wstool ->gibt wstool, um multiple workspaces zu verwalten

Mehrere gleiche Node-Typen aufmachen:
name ändern in vicon-launch

Ros Messages anschauen:
rosmsg show [message type]

Rviz (3D-Visualisierungssystem) zum anschauen

ROS Pfad: /opt/ros/melodic

Daten aufzeichnen und abspielen:
http://wiki.ros.org/ROS/Tutorials/Recording%20and%20playing%20back%20data

Cmake:
//https://crascit.com/2016/01/31/enhanced-source-file-handling-with-target_sources/
https://rix0r.nl/blog/2015/08/13/cmake-guide/

IDE: http://wiki.ros.org/IDEs
https://code.visualstudio.com/docs/setup/linux
https://marketplace.visualstudio.com/items?itemName=ms-iot.vscode-ros
code

Links:
http://wiki.ros.org/ROS/Tutorials/CreatingMsgAndSrv
http://wiki.ros.org/msg
-->http://wiki.ros.org/ROS/Tutorials/WritingPublisherSubscriber%28c%2B%2B%29
http://wiki.ros.org/ROS/Tutorials
http://wiki.ros.org/ROS/Tutorials/Creating%20a%20Package%20by%20Hand
http://wiki.ros.org/rviz/Tutorials/Markers%3A%20Basic%20Shapes
http://wiki.ros.org/rviz/Tutorials/Markers%3A%20Points%20and%20Lines
http://wiki.ros.org/rviz/DisplayTypes/Marker
http://docs.ros.org/latest/api/catkin/html/howto/format2/building_msgs.html
http://wiki.ros.org/vicon_bridge


----------
Hardware anschalten:

1. Stecker einstecken
2. anderen Rechner einschalten
3. anmelden: mobmonrob
4. vicon tracker neuestes ausführen
Wenn weißes Kabel nicht drin:
reinstecken
Netzwerk Konfig:
    192.168.10.1
    255.255.255.0


----------
Bauen:

source devel/setup.bash
am Anfang ausführen
->künftig vielleicht: https://answers.ros.org/question/205976/sourcing-from-multiple-workspaces/

Projekt bauen, von src initialisieren nach devel und build gelöscht:
catkin_make (clean)


----------
Laufen lassen:

source devel/setup.bash
am Anfang ausführen
->künftig vielleicht: https://answers.ros.org/question/205976/sourcing-from-multiple-workspaces/

(Kern enthalten) Nodes lokal starten: ->sonst schließt sich die erste Verbindung nach Start der zweiten automatisch
//roslaunch vicon_bridge vicon.launch
roslaunch vicon_bridge vicon_rviz.launch

Nachrichten auslesen im Worspace:
Neues Konsolenfenster:
//rostopic echo vicon/test1/test1
rostopic echo marker

----------
Getan:

Uhrzeit eingestellt
Dokumentation gesichtet
Tutorial angefangen
    ---> aktueller Stand: http://wiki.ros.org/ROS/Tutorials/UsingRqtconsoleRoslaunch
    //Problem: 2 seperate workspaces
        Lösung: source devel/setup.bash am Anfang ausführen (macht meinen temporär zum 1.)
    //Problem: roslaunch vicon_bridge vicon.launch -->Fehler wegen zwei Repos?
        Lösung: http://wiki.ros.org/catkin/Tutorials/workspace_overlaying
Tutorial weiter
src analysieren
git aktivieren
Unklarheiten klären
Integration beginnen
    Neuen Node erstellen
    VS code
    .launch zum Laufen bekommen
Rviz Daten Dummys bauen mit Code aus openpose -> MarkerBuilder::getTestMarker()
vicon_bridge zu mehreren Dateien refaktorieren
    ->testen gegen: roslaunch vicon_bridge vicon.launch
---
//Header erstellen
//main auslagern
---
Daten aus vicon_bridge holen
    Code verstehen
    Überlegen, wo angreifen
    X Sämtlichen ROS spezifischen Code raus holen
        ->zu aufwändig. Erst mal nur was einfügen, dass ich die Marker abgreifen kann bei der Erstellung
    ->MarkersProcessor nimmt die Daten
CMAKE nochmal anschauen verbessern
markers Sachen umbennen zum spezifizieren, was gemeint ist
vicon_bridge Unterscheidung, ob normal aufgerufen oder als Lib
MarkersProcessor hat einen MarkerBuilder und kennt einen markerPublisher
RvizMarkerBuilder bekommt die Daten von ViconMarkersProcessor und hat seine Konfiguration
Array zu Marker und wieder zurück
CMake include Fehler beheben
!!!Seltsamen Bug umgangen: Markers dürfen nicht von Methoden zurück gegeben werden weil sonst segfault
    falsch!!!! Eigentlich habe ich nur ein return bei einer Methode vergessen. Der Compiler hat das aber nicht bemängelt.
Datenzurück geben greht nicht beheben


----------
Aktuell:


MarkersProcessor Konveriertung ausprogrammieren
testen

Häh??
StransformStamped passt von der Datenstruktur her viel besser zu Rviz Markers??
Was bedeuten die Daten überhaupt??

Markers ist eine Liste von Marker
Ein Marker der vicon_bridge enthält einen Point mit Name translation
Transforms der vicon_bridge enthalten ??? eine Pose?

Marker von Rviz enhalten eine Pose die so aufgebaut ist wie ein Transform
außerdem kann man Point schicken

http://docs.ros.org/api/geometry_msgs/html/msg/Transform.html
http://docs.ros.org/melodic/api/geometry_msgs/html/msg/Point.html
http://wiki.ros.org/vicon_bridge
http://docs.ros.org/api/visualization_msgs/html/msg/Marker.html
        http://docs.ros.org/api/geometry_msgs/html/msg/Pose.html



Vielleicht hilft es mir etwas, in die Referenz des Vicon SDK + bridge code rein zu schauen, um zu verstehen, was die Daten bedeuten und folglich, wie die messages semantisch korrekt konvertiert werden.
Aber nur kurz. Dann Silvan fragen, falls nicht funktioniert.

Sonst auch erst mal ausprobieren eine Version, bevor so lange Überlege
Mit Testdaten in Rviz ausprobieren, dann mit vicon direkt






----------
Tun:

vicon testen
falls keine Messages durchkommen:
    vicon_bridge.cpp Z. 499: if (marker_pub_.getNumSubscribers() > 0)
    in Methode vicon_bridge::Markers ViconReceiver::process_markers(const ros::Time &frame_time, unsigned int vicon_frame_num)
    könnte eine Ursache sein
RvizMarkerBuilder Konfiguration auf Methoden Parameter verlagern


----------
Vielleicht tun:

Skripte für bauen und zum starten erstellen
RvizMarkerBuilder verbessern
Zunächst alles, was in ros mehr macht als nur Logging, raus nehmen
Alles ros Spezifische aus vicon_bridge raus nehmen
vicon_bridge.cpp in vicon_receiver.cpp umbenennen (auch *.h)
https://github.com/KumarRobotics/vicon/blob/master/vicon_driver/src/vicon_driver.cpp


----------
Klassenstruktur:

Main: hat einen NodeStarter, dem der ViconRvizNode übergeben wird
NodeStarter: enthält Boiler Plate, um Nodes auszuführen, polymorph
ViconRvizNode: enthält Code, der für den Node spezifisch ist -> was wird gepublished, ...

MarkerBuilder:
    enhält und speichert Konfiguration(en), um Marker zu bauen und baut sie
    ist konfigurierbar
    Mischung aus: Wird wo anders konfiguriert (template), sind Standardwerte da (Methodenaufruf), Parameterübergabe
    Templates erstellen für semantisch sinnvolle Marker
    https://github.com/stevenjj/openpose_ros/blob/master/skeleton_extract_3d/src/skeleton_extract_3d_visualization_node.cpp
    http://docs.ros.org/api/visualization_msgs/html/msg/Marker.html

vicon_bridge (->vicon_receiver): holt Daten von vicon
Builder Bridge Kleber: holt die Daten von der Bridge und gibt sie dem Builder


----------
Debuggen:

catkin_make -DCMAKE_BUILD_TYPE=Debug

launch-prefix="gdb -ex run --args
ergänzen in .launch Datei. Bsp: <node pkg="vicon_bridge" type="vicon_bridgeNode" name="vicon_bridgeNode" output="screen" launch-prefix="gdb -ex run --args">

dann ganz normal ausführen.

return Taste klicken bei Nachfrage

gdb Backtrace:
bt
->return Taste, um mehr zu sehen


----------
Achtung:

Markers nicht von Methode zurück geben lasse! ->Gibt segfault
Stattdessen: MarkersPtr benutzen!
----------

vicon API Dokumentation
Vicon DataStream SDK alt: S. 60(65)



Wenn Zeit habe: Silvan nochmal fragen: Er meinte, ich solle für Oliver was bauen, das sie Samplerate des vicon Systems ausliest und damit was macht.

